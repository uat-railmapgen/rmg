import{$ as F,u as H,j as r,O as L,e as P,a7 as N}from"./chakra-oLgDt0ZB.js";import{b as z,c as O,u as f,e as g,b8 as y,i as W,ar as G,aq as Z,as as $,b9 as B}from"./index-CTDscA0t.js";import{r as o}from"./react-Fl03amIb.js";import{g as _,R as q}from"./app-router-go4QNGgS.js";import{m as J}from"./ag-grid-RxoLydf6.js";import"./param-manager-utils-sep_DFhl.js";var K=function(c){var l=c.children,t=F().colorMode,d=H("RmgAgGrid");return r.jsx(L,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:d,children:l})};function Q(c){const{lineNumber:l,stationNumber:t,lineColour:d}=c,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:d,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return r.jsxs(P,{sx:i,children:[r.jsx("span",{children:l}),r.jsx("span",{children:t})]})}function se(c){const{branchIndex:l}=c,{t,i18n:d}=z(),i=O(),x=f(n=>n.app.sidePanelMode),{style:m,theme:R,stn_list:S,line_num:j,coline:M}=f(n=>n.param),b=f(n=>n.helper.branches),[A,T]=o.useState([]);o.useEffect(()=>{const n=b[l].reduce((e,s)=>["linestart","lineend"].includes(s)?e:[...e,{...S[s],id:s,rowSpan:i(_(s,l))}],[]);T(n)},[b,l,S]);const v=o.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:n})=>r.jsx(Q,{lineNumber:j,stationNumber:n,lineColour:R[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(m)},{headerName:t("Chinese name"),field:"name",valueFormatter:({value:n,data:e})=>n[0]+(m===g.GZMTR&&(e!=null&&e.secondaryName)&&(e!=null&&e.secondaryName[0])?" (".concat(e.secondaryName[0],")"):"")},{headerName:t("English name"),field:"name",cellRenderer:({value:n,data:e})=>r.jsx(q,{text:n[1]+(m===g.GZMTR&&e.secondaryName&&e.secondaryName[1]?" (".concat(e.secondaryName[1],")"):"")}),minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:n})=>r.jsx(N,{children:n.groups.map(e=>{var s;return(s=e.lines)!=null?s:[]}).flat().map((e,s)=>{var a,h,w,C;return r.jsx(y,{name:e.name,bg:(h=(a=e.theme)==null?void 0:a[2])!=null?h:"#aaaaaa",fg:(C=(w=e.theme)==null?void 0:w[3])!=null?C:W.white,showShortName:!0},s)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:n})=>{var e;return(e=n==null?void 0:n.rowSpan[0])!=null?e:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:n})=>n[0]>0},cellRenderer:({value:n})=>{var e,s;return r.jsx(N,{children:(s=(e=M[n[1]])==null?void 0:e.colors)==null?void 0:s.map((a,h)=>r.jsx(y,{name:[a[4],a[5]],bg:a[2],fg:a[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(m)}],[m,R.toString(),d.language]),u=o.useRef(null),p=o.useRef(!1);o.useEffect(()=>{p.current&&u.current&&u.current.api.getSelectedRows().length===1&&x!==G.STATION&&u.current.api.deselectAll()},[p.current,x]);const[k]=o.useState({resizable:!0}),I=o.useCallback(()=>{p.current=!0},[p.current]),D=o.useCallback(({api:n})=>{var s;const e=(s=n.getSelectedRows())==null?void 0:s.map(a=>a.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",e),e!=null&&e.length&&(i(Z(G.STATION)),i($(e[0])),i(B(void 0)))},[]),E=o.useCallback(({data:n})=>n.id,[]);return r.jsx(K,{children:r.jsx(J.AgGridReact,{ref:u,rowData:A,defaultColDef:k,columnDefs:v,getRowId:E,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:D,onGridReady:I,debug:!1})})}export{se as default};
